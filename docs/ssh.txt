ssh
======

2010.09.19
----------

   1. h2 script
   save/backup.sql

2010.09.12
----------

   1. mvn compile 可考虑升级到2.3.2

   2. 表达式引擎 aviator
http://code.google.com/p/aviator/
http://www.xhsky.net/book/0/18/1228690.html

   3. cygwin 下 sshd 配置，与类 Linux 平台的互通

命令 1：chmod +r /etc/password
命令 2：chmod +r /etc/group
为 /var 目录添加 d..x..x..[xt] 访问权限。
命令 3：chmod 755 /var

运行 ssh-host-config 的配置脚本对 SSHD 服务进行配置，在配置过程中注意下面的配置选项：

Should privilege separation be used 提示是否要为服务创建新的权限，
   OpenSSH3.3 之后的 SSHD 服务器版本，默认是需要为其创建独立的权限，此处填 yes 之后输入回车键进入下一个选项。 
Do you want to install sshd as service 提示是否需要创建 SSHD 服务并注册为 Windows 服务，
   此处填 yes 之后输入回车进入下一个选项。（实际操作时，输入yes后，需设置daemon ，以下操作不再需要） 
Do you want to use a different 提示是否需要使用其他的账户管理 SSHD 服务，
   如果选择” no ”的话，会指定一个默认的用户作为管理 SSHD 服务的账号。
   当然，用户也可以为 SSHD 服务建立一个新的账号，然后输入需要建立的用户名，在本例中选择新建一个账号，输入 sshadm 作为用户名。 
Create a new privileged user account: sshadmin 提示是否为用户指定新的权限，
   推荐使用“ yes ”选项。这时要注意，如果选择“ yes ”的话，在配置 SSHD 服务的时候会使用独立的账号权限，
   所以要注意在配置 SSHD 服务的过程中，一定不要使用需要在进行无密码访问过程中，用来登陆系统的用户来实现 SSHD 服务的控制。
   否则，进行 SSH 访问的时候，只会读取该用户作为系统用户的权限，而不会读取它作为 SSHD 服务的权限，这样会导致访问 SSHD 服务失败。 
随后提示输入该用户名的密码。 
创建一个新的用户以后，需要在 cydwin 的命令环境中通过 su 命令检验用户的密码是否指定成功，如果密码设置不正确，SSHD 服务启动过程会失败，这就需要在特权账号下使用 passwd 命令修改其密码。

完成配置过程后，就将 SSHD 服务添加到了 cygwin 的服务中，可以通过运行 cygrunsrv 命令查看，启动或停止该服务。
查看 cygwin 中服务的命令：cygrunsrv -L
启动 SSHD 服务的命令：cygrunsrv -S sshd
停止 SSHD 服务的命令：cygrunsrv -E sshd

如果配置后发现配置过程中存在问题，还可以删除 SSHD 服务，然后重新进行配置过程。删除 SSHD 服务的命令：cygrunsrv -R sshd
另外，由于 SSHD 已经被加入到 windows 服务管理器中，因此，可以直接在在 windows 注册服务管理中，启动和停止 SSHD 服务。

-- 使用
首先在访问机上生成账户的密钥 (安装cygwin 的windows 客户机)
1. 生成密钥
-- cd ~
-- mkdir .ssh
ssh-keygen -N "" -t rsa -f ~/.ssh/id_rsa 

将密钥文件上传到被访问机上 
2. 复制密钥文件到目标机
scp -q ~/.ssh/id_rsa.pub root@$target_host:/tmp/ausaod01_rpub_key 

将密钥内容添加到被访问机器的系统用户的 /.ssh/authorized_keys 文件中 
3. 写入密钥内容
ssh root@$target_host  \n
 "mkdir -p ~/.ssh; cat /tmp/ausaod01_rpub_key >> ~/.ssh/authorized_keys" 

至此，用户就可以在访问机上通过 ssh 命令直接访问被访问机，无需提示用户输入密码口令。
利用 Cygwin 实现平台互通的例子
对一个包含了 Linux 操作系统，Windows 2003 操作系统服务器的应用平台做性能数据采集，
由于服务器数量比较多，因此，依次登录每台机器通过命令来采集服务器的性能数据即费时费力，
产生的结果格式也不统一，不便于进行总结和分析。
为此，开发了一个 shell 脚本在一台服务器上运行，通过远程访问命令在应用平台中的各个服务器上上传并运行 shell 脚本采集性能数据并将结果传送回服务器。
由于平台中有无法直接运行 shell 脚本的 Windows 操作系统，因此，无法与服务器进行互通，所以，需要在 Windows 操作系统上安装本文介绍的 Cygwin 软件，来制造类 Linux 环境运行脚本并实现与 Unix、Linux 服务器的互通。
首先，按照本文所述在 Windows 服务器上安装并配置 SSHD 服务，同时设置与性能数据采集服务器之间的无密码访问。

清单 4. 平台互通脚本实例
function startdetector { 
 SSH_OPTIONS="-o StrictHostKeyChecking=no -o PasswordAuthentication=no -o loglevel=QUIET" 
 ACCOUNTNAME='LogonAcc' 
 HOSTNAME='TestMachine' 
 PD_INSTALL_DIR='TestDIR' 
 PD_SRC_DIR='ScriptDIR' 
 SCRIPTNAME='TestScript' 
 MACHINE_resultdir='ResultCollectionDIR' 
 RESULTFILE='ResultFile' 
    
 # 拷贝脚本文件到远端机器
 ssh ${SSH_OPTIONS} "${HOSTNAME}" "rm -rf ${PD_INSTALL_DIR}; 
 mkdir -p ${PD_INSTALL_DIR}" &>/dev/null 
 scp ${SSH_OPTIONS} -r ${PD_SRC_DIR}/${SCRIPTNAME} 
 ${ACCOUNTNAME}@${HOSTNAME}:${PD_INSTALL_DIR}/${SCRIPTNAME}  \n
        &>/dev/null 
  
    # 在本地创建结果目录
    
    mkdir -p ${MACHINE_resultdir} &>/dev/null 
    
    # 执行远端脚本监控数据
    ( 
        ssh $SSH_OPTIONS $ACCOUNTNAME@$HOSTNAME "${PD_INSTALL_DIR}/${SCRIPTNAME}" 
    ) 
    
    # 取回脚本执行结果
    scp $SSH_OPTIONS ${ACCOUNTNAME}@${HOSTNAME}:${RESULTFILE} 
    ${MACHINE_resultdir}/ &>/dev/null 
    
 } 

该示例中定义了 SSH 命令参数，远端机器的用户名和机器名，本地脚本存放路径，脚本名，结果目录名，远端机器的脚本存放路径，结果保存目录等变量。实际的操作当中，完全可以将下面的操作该成循环的实现方式从而实现对多个远端服务器的监控。
例子中提到的脚本 TestScript 可以由读者任意编写，它可以是运行在 Linux 环境下的任何命令组成的脚本文件，包括文件的处理，性能的监控等操作。下面的脚本实现只实现了本文所介绍的环境互通方面的功能。读者还可以扩充脚本实例的功能来提高平台互通之间的交互性。

2010.09.07
----------
   09.19
   早上没爬起来，昨天1点才睡，看豪斯医生，8点半才到15楼，买了一袋牛奶。
   今天才叫郁闷，下班前他们请客吃饭，我们说晚上要走没去，出门打的，错到了四方，重新到火车站，买票时说今天晚上没车，只能买了明天9点，
   晚上我和颜俊两个人两手拎了包，从401到火车站走了个来回，相当郁闷。
   到华联商厦买了两个树脂工艺品，86元。
   这回到青岛，个人花销估计有1000元了。
   86
   95.4
   50
      
   09.18
   早上9点起床，在房间里看看hibernate 文档，下午安排出去一趟，到市里转转。
   吃完午饭到市政府坐车，到新华书店转转，比常州大，买了两本尤劲东的连环画人到中年，50元。

   09.17
   佛山跌停，佛塑也差不多回到买入价，这回来青岛一趟，股价走了个过山车。
   今天回不去了，明天休息，周日上班，只能周日晚上走了。

   09.16
   核对医保数据。
   今天佛山照明复牌，涨停，手上还有2手，当时是想出掉佛山照明换佛塑，没想到照明还这么厉害。
   
   09.15
   早上起来，嗓子疼，想想昨天也没吃什么。
   下午给河南武警来的一个财务领导汇报6个系统。
   今天000973跌了4%，两天共跌了1块。

   09.14
   本想晚上回常州，下午医保办核对数据，有点问题，只能周五回去了，这几天把问题解决。
   晚饭后，和老姚、颜俊到家乐福转转，买了点东西，刷卡94元，回去后，颜俊给了我50元。
   下午打电话回家，晨晨接的电话，老三老四地问我为什么没回家，现在接电话时说话比以前流畅。

   09.13
   下午给军区窦部长汇报系统。
   打电话给家里，晨晨发烧、咳嗽半周了。

   09.12
   早上8点和颜俊一块出发，坐304到崂山，门票100，太清宫20，太清索道80，中午吃饭303，找了个导游50。
   崂山还是值得看看的，就是费用高了点。
   不过今天我做了件丢人的事，居然相信了算命的，给了香火钱400（后来想想算命的就是平常的一个年轻人，不应该是道观里的），
   主要是他说到了我这个人付出的多，得到的少，我再联系到现在工作和薪水的事，当时一下子被他蒙住了，
   真的，不管他是不是随便瞎说还是什么，当时对我来说，就感觉到冥冥中怎么有人这么灵，这事都知道，
   至于其他内容，什么今年要避开两种事，丧事和生孩子，平常要担心身边的小人，一种是鹰钩鼻一种是络腮。
   不过抽到了一个上上签，但感觉是他作弊，因为最后倒出来的都是下下签，感觉太假了，问题是当时我脑筋傻傻的，只听他忽悠了，有点他说什么我就做什么的状态，
   妈的，平常受的教育都到哪里去了。
   所以说每个人都是有弱点的，平常想想都不可能的事，有时就是会发生到自己身上，教训啊教训。
   到门诊厅取了500。
   事后想想，自己在平时的表现也有问题，平时把什么都不当回事，而到了一些场合又表现的很低级，也可以说是不成熟，特别是一些人事交际。
   这方面也可以说是我的缺陷，比如，如果现在需要去和老板谈薪水待遇问题，应该怎么谈，好像心中没什么数目；又比如，如果要求人去办点事，该怎么去做，好像也没什么数目。

   09.11
   下午给401医院领导汇报实施的项目，我讲得不是很流畅。
   晚上回房间看豪斯医生。

   09.10
   下周一军区窦部长过来看系统实施情况，我只能等到周二回去了。
   晚上到家乐福转转，花了35元，买了大瓶装可乐。
   回到房间，看豪斯医生。
   公司新来的小倪辞职了，估计受不了出差，也是，公司发展到现在，出差人员在外面的条件还是这么差，没人愿意出差。
   还是要替自己想想以后发展，公司是没什么可留念的，没福利，薪水一般，我到公司五年，还只有7万，以后花钱的地方很多，
   昨天丁奕玲告诉我，婆婆准备订北大街的房子，想想现在也没什么可投资的，买房子也不错，不过要准备钱了。

   09.09
   今天是老毛逝死多少周年，刘主任喝酒前说的。今天做pask的青岛乔经理请客信息科，就在边上的大昌，我们作陪，好像我喝的挺高，还好没吐，
   今天信息科，任姐、冯姐、边、冷工倒没怎么喝，小王倒喝了不少。刘主任牛X，喝多少都没问题，周主任也和我一样喝了不少。
   回到房间，看豪斯医生，一直到12点过后才躺下睡觉，当中还吐了一回。

   09.08 
   从昨天晚上开始青岛下小雨，今天早上没去食堂，吃了昨天买的方便面。
   昨天晚上只看了一集豪斯医生，感觉累，洗完衣服后，洗澡睡觉。

   09.07
   中午因为吃饭地点的事一块找了门主任，小谭感到委屈的。和小谭聊了涨工资的事，林工、姚工现在每月算下来有1万，比瞿还多，
   感觉老高现在招人都是外来的和尚好念经，收入都比老员工高，老员工老老实实做事的，都拿不高，颜俊这么辛苦也只有5万比王可心6万还少，
   新来的陈志光也每月4000,陈鑫现在做得这么好才涨到3500。

   我拿到现在也只有7万。
   工资的事先放放，知道这事就行。
   青岛医保做下来，感觉医保有做头，一是技术有挑战，多用户多并发，二是市场有前景，医保数据已，含有病人所有数据，可以分析很多项目，
   如病种费用、药品费等等。

   晚饭后到家乐福转转，43元买了点啤酒、方便面，20点到15楼加班到21:30,感觉有点累。

   09.06
   坐了10个钟点的汽车，感觉头晕，前两回没这事。
   晚上到住的地方，洗澡洗衣服，吃了碗方便面。
=======
2010.09.04
----------

   09.05
   上午到乐购超市转转，中午到我妈家吃饭，下午到邮局买了明天中午11:50分的汽车票，到健身房锻炼，拉背推肩。

   09.04
   早上6点到常州，到三鲜馄饨店吃了碗面。回家洗澡。
   取4000，3300用于杨晨幼儿园学费。
   下午去锻炼。

   09.03
   中午去长途汽车站买票，228元。顺便到华联商厦转转，买了4个人工琥珀，送给小孩玩玩，140元，海马、海星，漂亮是漂亮，
   回去给小谭看了后，说崂山卖这个东西的地方很多，不知是否要便宜点。

   09.02
   中午刘主任给大院子汇报软件开发工作，到12点，请我们到谭鱼头吃火锅。
   晚上加班到11点。

   09.01
   晚上刘主任在徐记海鲜请客，还有刘主任的战友、其他医院的主任，我大概喝了3瓶青岛啤酒，还行，最后没吐，颜俊喝了6.6白酒，1瓶多啤酒，吐了。

   08.31
   到青岛，晚上没睡好。房间换了，吃饭的地方也换了，到后面小房间。

   08.30
   晚上8点的汽车。

2010.08.28
----------

1、青岛老劈柴院海鲜

2010.08.27
----------

1、有空关注下pos项目floreantpos，一直想搞个pos

svn co https://floreantpos.svn.sourceforge.net/svnroot/floreantpos floreantpos

2010.08.26
----------

1、有空关注下 Hibernate Search，与Lucene查询有不同

   1. <dependency>
   2.     <groupid>org.hibernate</groupid>
   3.     <artifactid>hibernate-search</artifactid>
   4.     <version>3.3.0.Beta1</version>
   5. </dependency>

QueryBuilder mythQB = searchFactory.buildQueryBuilder().forEntity( Myth.class ).get();

//look for popular modern myths that are not urban
Date twentiethCentury = ...;
Query luceneQuery = mythQB
    .bool()
      .must( mythQB.keyword().onField("description_stem").matching("urban").createQuery() )
        .not()
      .must( mythQB
        .range()
        .onField("starred")
        .from(3).excludeLimit()
        .to(5)
        .createQuery() )
      .must( mythQB
        .range()
        .onField("creationDate")
        .above(twentiethCentury)
        .createQuery() )
    .createQuery();


2010.08.23
----------

1、ssh 增加db-init.bat,db-export.bat功能，公司环境能正常运行。

2、tools\h2\start-db.bat 增加oracle访问

2010.08.21
----------

1、修改showcase test 取消部分测试内容

   备份h2数据库,save/back.sql,back2.sql

   装载数据 bin/db-init.bat，环境ant1.7需maven-ant-tasks-2.1.0.jar

2010.08.14
----------

1、升级到3.3.3

2、memcache 測試環境
   org.springside.modules.memcached.JmemcachedServer

2010.08.08
----------

1、增加

      <dependency>
        <groupId>commons-httpclient</groupId>
        <artifactId>commons-httpclient</artifactId>
        <version>${httpclient.version}</version>
      </dependency>

   不知与
      <dependency>
        <groupId>org.apache.httpcomponents</groupId>
        <artifactId>httpclient</artifactId>
        <version>4.0.1</version>
      </dependency>
   有什么关系

2、使用spring中的Log4jConfigListener有如如下好处：

   1. 动态的改变记录级别和策略，不需要重启Web应用，如《Effective Enterprise Java》所说。
   2. 把log文件定在 /WEB-INF/logs/ 而不需要写绝对路径。
因为 系统把web目录的路径压入一个叫webapp.root的系统变量。这样写log文件路径时不用写绝对路径了.
log4j.appender.logfile.File=${webapp.root}/WEB-INF/logs/myfuse.log
   3. 可以把log4j.properties和其他properties一起放在/WEB-INF/ ，而不是Class-Path。
   4.log4jRefreshInterval为60000表示 开一条watchdog线程每60秒扫描一下配置文件的变化;
   在web.xml 添加
    <context-param>
        <param-name>log4jConfigLocation</param-name>
        <param-value>WEB-INF/log4j.properties</param-value>
    </context-param>

    <context-param>
        <param-name>log4jRefreshInterval</param-name>
        <param-value>60000</param-value>
    </context-param>

    <listener>
        <listener-class>org.springframework.web.util.Log4jConfigListener</listener-class>
    </listener>

3、取消logback

4、mvn jetty plugin add ssl
   http://mrhaki.blogspot.com/2009/05/configure-maven-jetty-plugin-for-ssl.html

   增加keytool
   mvn  keytool:genkey
         keytool:clean

   org.ssh.app.common.web.HttpsUrlRewritingInterceptor 例子运行没成功。
   采用/init/index，没找到匹配，
   采用/init/*，index动作不会匹配到，随意采用一个不存在的动作，虽然报错，但会跳转到https

5、/ /* 的区别
   / 匹配路径
   /* 匹配所有，采用该方式后，jsp后缀的页面也会被DispatcherServlet匹配，报找不到对应控制器,所以还是采用/

   http://www.coderanch.com/t/364782/Servlets/java/there-key-difference-between-url

2010.08.07
----------

--参考年轻构架师
1、hibernate 映射

   a. 使用合成(synthetic identifiler) 或代理(surrogate) 主健
      即采用没有业务含义的字段如 protected Long id;

   b. 不要使用复合主键

   c. 强烈建议引入 version or timestamp

      解决并发控制 optimistic locking.

      但各自也有问题，version在达到数据类型最大值后，hibernate 不会自动归0，而是报异常
      timestamp 信赖于jvm 及 os的时间精度

   d. 使用中间表映射多对多关系，如用户与角色

   e. 尽是不要使用 class inheritance 映射

   f. 永远不要使用List

      ?? 要查下资料理解下

   g. EntityIntereptor

      对核算字段，如create_time, update_time ，实行自动插入值
      参考hjpetstore2中 AuditInterceptor

   h. 不要指定任何lazy=false

      如果使用了lazy = true,可在代码中显示使用eagerly fetch

       return  getSession().createCriteria(Order.class)
                .setFetchMode("shipAddress", FetchMode.JOIN)         --
                .setFetchMode("billAddress", FetchMode.JOIN)         --
                .setFetchMode("orderLineItems", FetchMode.JOIN)      --
                .setFetchMode("orderLineItems.item", FetchMode.JOIN) --
                .add(Restrictions.between("createTime", from, to))
                .addOrder(org.hibernate.criterion.Order.asc("orderStatus"))
                .list();

       String hql = "FROM Order AS o "
                 + "INNER JOIN FETCH o.shipAddress a "               --
                 + "INNER JOIN FETCH o.orderLineItems oli "          --
                 + "INNER JOIN FETCH o.paymentPartner pp "           --
                 + "LEFT JOIN FETCH oli.item i "                     --
                 + "WHERE o.createTime BETWEEN :from AND :to "
                 + "ORDER BY o.orderStatus ASC ";

   i. 显示指定外键名

   j. 二级缓存

      设置read-only,read-write 实体使用二级缓存，

      最好不使用查询缓存??

2、kaptcha

   参考 hjpetstore UserFormController.validateCaptcha

3、https

   HttpsUrlRewritingInterceptor

   使用参考hjpetstore-servlet.xml

4、soa public api key

   每个注册用户有个 api key,每次访问服务时需带上个api key，这样保证了web service的安全性

   HjpetstoreController

   --有关安全方面，还是要再看下项目代码

5、p86 spring jms

6、win2003安装ip6

运行：cd 、\
      netsh
      int ipv6
      install     耐心等待确定
这样就可以啦，如果想自己配置，就在ipv6模式下输入add address "本地地址" [ipv6地址]
--感觉现在没什么用处，翻墙现在也不是很方便

2010.08.05
----------

1、core 增加 ServiceException 异常类
   cd module/core
   mvn install

2、sshapp 改变jdk支持版本为1.6,pom.xml

      <!-- compiler插件, 设定JDK版本 -->
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-compiler-plugin</artifactId>
        <configuration>
          <source>1.6</source>
          <target>1.6</target>
          <showDeprecation>false</showDeprecation>
          <encoding>${project.build.sourceEncoding}</encoding>
        </configuration>
      </plugin>

3、新增hjpetstore中几个包
   common/monitor
   util/Base64Coder.java
   util/CalendarUtil.java
   util/CustomCalendarEditor.java
   util/EmailSender.java
   util/FileUtils.java
   util/MessageDigestUtil.java
   util/RSAUtil.java
   util/RestCredentialsTemplate.java
   util/SimpleTextEmailSender.java

   所加的monitor.xml 与原有jmx 配置有冲突

4、增加所需的mvn，kaptcha,zapcat
   save/my-mvn

2010.08.03
----------

1、Asynchronous method invocation in Spring 3.0
The @Async annotation
The @Async annotation allows invocation of that method to occur asynchronously.
In other words, the caller will return immediately upon invocation.

http://www.skill-guru.com/blog/2010/01/13/asynchronous-method-invocation-in-spring-3-0/

2010.08.01
----------

1、jmx、jms

   19:07 - 20:02
   20:17 - 20:35
   21:15

2010.07.28
----------

1、采用最新hibernate3.5.4

   org.springside.modules.orm.hibernate.HibernateDoa
   修改 countCriteriaResult 方法

2、cd modules/pare
   mvn clean
   mvn install
   cd modules/core
   mvn clean
   mvn eclipse:clean
   mvn eclipse:eclipse
   mvn install
   cd modules/extension
   mvn clean
   mvn eclipse:clean
   mvn eclipse:eclipse
   mvn install

   mvn application/sshapp
   mvn clean
   mvn eclipse:clean
   mvn eclipse:eclipse

3、springside - core 增加 resources 支持(spring3.04版本直接支持)

2010.07.26
----------

1、增加spring mvc-showcase 例子，只支持3.0.4.BUILD-SNAPSHOT
   http://www.dzone.com/links/r/spring_mvc_3_showcase.html

   改为 3.0.3.RELEASE
   参考 spring-samples\petcare-trunk，servlet-context.xml 中增加对 <petcare:resources />的支持

   添加以下文件(3.0.4已不需这样操作，默认支持)
   main/resources/org.springframework/util/config/spring-petcare-3.0.xsd
   META-INF/spring.handlers, pring.schemas
   main/java/org/springframework/util/config/.., resource

   还有个问题，采用mvn eclipse:eclipse 产生项目导入eclipse，报以下错误
   Java compiler level does not match the version of the installed Java project facets

2010.07.20
----------

1、尝试spring3.03, jetty 7.1.4.v20100610

2、restful风格，
   petcare-trunk,eggsy-spring3-restful-example web.xml中直接采用过滤，不用urlwriter

   这样做法，就需要在程序中写全url,如/app/student(采用了/app/*过滤)，如果采用了/*，还要考虑静态文件的url，
   petcare-trunk好象是通过 servlet-context.xml中定义
   <!-- Handles HTTP GET requests for /resources/** by efficiently serving up static resources in the ${webappRoot}/resources directory -->
   <petcare:resources />

3、增加tiles支持

   app-servlet.xml 中取消
   <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver" p:prefix="/views/" p:suffix=".jsp" p:order="10"/>

   以前所有viewname都对应一个/views/下一个jsp文件，现改为对应titles.xml中一个 definition name=?

2010.07.13
----------

1. 线程学习
   org.ssh.app.example.thread

2010.07.12
----------

1、Hibernate Recipes A Problem-Solution Approach.pdf

   a. org.ssh.app.common.entity.Contact

   b. 继承表，采用同一张表
      org.ssh.app.example.entity.Disc_1
   c. 继承表，采用不同表(后台相应产生了3张表)
      org.ssh.app.example.entity.Disc_2

   也可参考 org.ssh.app.common.entity.Post，体会下。

   p 125 many to one
   book -- many to on -- publisher
   book 类中定义
   @ManyToOne
   @Cascade(value=CascadeType.SAVE_UPDATE)
   @JoinTable(name="book_publisher", -- 后台表名
              joinColumns=@JoinColumn(name="book_id"),
              inverseJoinColumns=@JoinColumn(name="publisher_id"))

   d. p140

   mapping a set
   -- have no duplicate,

   book -- has more chapter -- chapter
   book 类中定义
   private Set chapters;
   @CollectionOfElements(targetElement=java.lang.String.class)
   @JoinTable(
      name="book_chapter",
      joinColumns=@JoinColumn(name="book_id")
   )
   @Columne(name="chapter_name")
   --后台生成的表book_chapter以book_id + chapter_name 为主键

   mapping a bag
   --have duplicates
   private Collection chapters = new ArrayList();
   ----后台生成的表book_chapter没有主键，当然也可以产生一个产生主键的策略p145

   mapping a List
   --p148
   --it's an ordered collection

   mapping an array
   --一般为解决遗留项目，大多会采用List

   mapping a Map
   -- p152

   using Interceptors
   -- p214 定义拦截

2. Fetch 策略

@Fetch(FetchMode.JOIN) 会使用left join查询  只产生一条sql语句
@Fetch(FetchMode.SELECT)   会产生N+1条sql语句
@Fetch(FetchMode.SUBSELECT)  产生两条sql语句 第二条语句使用id in (.....)查询出所有关联的数据

2010.07.09
----------

1、增加xmemcached pom.xml支持
   save/xmemcached-User_Guide_zh.htm

2010.07.08
----------

1、修改菜单显示

   14:30 - 17:18

2010.07.06
----------

1、Share Nothing Architecture spring？

2010.07.05
----------

1、License3j 及 gpg 简单使用
   save/license3j+gpg.txt

2、spring安全策略修改，同一ip，用户可进行多次登录，不同ip只能等上次用户退出或会话过期才能登录
   ch214-smart-concurrent.html
   但spring security 3中对部分类不支持，编译没通过
   org.ssh.app.security.SmartConcurrentSessionController

2010.07.02
----------

1、建立本地oracle.jar
-在含有ojdbc14.jar的目录下运行
mvn install:install-file -Dfile=ojdbc14.jar -DgroupId=com.oracle -DartifactId=oracle -Dversion=10.2.0.2.0 -Dpackaging=jar -DgeneratePom=true

2、linux下eclipse 需手工设置 M2_REPO

3、add opencsv

2010.07.01
----------

1、加入spring httpInvoke

   21:00 - 22:26

   http://snowolf.javaeye.com/blog/703732

   remote-servlet.xml,org.ssh.app.httpinvoke
   测试:  client.UserServiceTest
   暂时不考虑用户权限

2010.06.30
----------

1、security + extjs
  20:00 - 21:22

2010.06.28
----------

1、security + extjs
  21:00 - 21:45

2010.06.27
----------

1、spring security + extjs
  http://loianegroner.com/2010/02/integrating-spring-security-with-extjs-login-page/
  19:00 - 20:34

2010.06.25
----------

1、初始基础数据
   http://localhost:8089/sshapp/init/index

   完成后，通过app-servlet.xml中配置自动指到index.jsp

2010.06.24
----------

1、关注eclipse下编写wiki
   http://eclipse.dzone.com/articles/getting-started-wikitext
   可查看eclipse下相关帮助

2010.06.23
----------

1、网上教材版本与本项目不一致。

2010.06.22
----------

1、增加jalopy(格式化java文件)
   parent/pom.xml
   jalopy.xml

   use: mvn jalopy:format

2、参考oa-trunk中
  org.mortbay.jetty.maven-jetty-plugin服务器jetty
  scanIntervalSeconds热部署时间间隔10s
  webDefaultXml使用自定义的webdefault.xml，解决静态资源被锁定的问题

3、增加mvn report

   user: mvn site

   --运行还有问题

4、spring securty 登录认证，增加method="post"

2010.06.21
----------

1、http://www.family168.com/oa/springsecurity/html/ch003-custom-db.html

   14：00 - 15：36

2、增加本地文档、例子
   save/springsecurity.zip，springsecurity-sample.rar

3、21:45 - 22:28

   http://www.family168.com/opensource.html

   oa = spring + extjs + hibernate
   http://family168.googlecode.com/svn/trunk/

   代码美化工具jalopy
   save/jalopy-eclipse-0.2-1.5rc3.zip


2010.06.20
----------

1、http://www.family168.com/oa/springsecurity/html/ch001-helloworld.html

   采用spring security 3.0.2
   21:20 - 21:37

2010.06.16
----------

1、20:00 - 20:55
   21:12 - 21:21

   采用spring restful 需注意url的写法，在extjs中url的定义与jsp文件(包含js文件)路径有关。
   一般jsp文件在views中。
   如 book/book.jsp 中包含 book-grid-row-expander.js,js中url的定义采用了../books/getBooks
   访问：http://localhost:8089/sshapp/book/book.jsp

   crud例子:http://localhost:8089/sshapp/book/index.jsp

2、测试 java 最大可用内存
   在命令行下用 java -XmxXXXXM -version 命令来进行测试

2010.06.15
----------

1、手工配置spring 方法缓存
   resources/cache/applicationContext-ehcache.xml
   --需手工指定bean及方法

2、增加 ehcache.annotations
   http://code.google.com/p/ehcache-spring-annotations/
   --暂时不用

3、增加CacheUtil
   手工处理ehcache

2010.06.14
----------

1、mvn 方式,json报错找到原因
pom.xml 中对jetyy方式运行,hibearnat采用了lazy,暂时注释掉

2、加入javamelody(监控java运行)，
只引入的pom.xml中dependency,还没完成

2010.06.13
----------

1、19：28 - 20:45

   ext url 路径问题?

2010.06.11
----------

1、采用jetty嵌入式运行，没问题。

2010.06.10
-----------

1、还原json-lib,
   jackson 1.5.2

2、19：10 - 20：38
   21:09 -21:27
   application/ekapp

   起用公司eking，同样效果，不行。
　　
2010.06.09
----------

1、21:00 - 22:30

   取消json-lib（需spring2.5.6支持）, 更改jackson 版本为1.4.2，1.5.2在spring3.0.2下有问题(http://jira.springframework.org/browse/SPR-7063?page=com.atlassian.jira.plugin.system.issuetabpanels%3Achangehistory-tabpanel)

2010.06.08
-----------

1、9：30 - 11：00
   14：30 - 15：32

   找到原因了，实体下定义必须采用类属性，不能用Int
    private Long edition;
    private Long pages;

2010.06.07
----------

1、14：30 - 17：00

   json-lib 还是不行
   还是报net.sf.json.JSONException: java.lang.reflect.InvocationTargetException
   网上资料一般是表中采用了Date字段，或hibernate有lazy，才有以上报错。

   19:00 - 19:52

   开始以List<String> 做测试，json正常
   取消Book中
//    public String toString() {
//        return ToStringBuilder.reflectionToString(this);
//    }
   json正常。妈的，想骂人。

   json-lib-2.3-jdk1.5
    * jakarta commons-lang 2.4
    * jakarta commons-beanutils 1.7.0
    * jakarta commons-collections 3.2
    * jakarta commons-logging 1.1.1
    * ezmorph 1.0.6

   就是不能采用以上toString方法

   20:00 - 22:42

   好象还不行。
   json-lib + spring 是否只适用于 2.5?

   结合 http://stackoverflow.com/questions/2038642/help-with-spring-json-using-annotated-controllers 配置，采用ModelAndView,
   JsonController
   curl -i -X GET http://localhost:8080/sshapp/jsons/getBooks4


2010.06.06
----------

1、19:36 - 19:39
   20:23 - 20:27
   20:43 - 20:53
   21:12 - 22:57

   相关文件
   webapp/book/index.jsp
         /js/book

   奇怪，昨天正常的测试curl -i -X GET http://localhost:8089/sshapp/jsons/getBooks ,
   报：net.sf.json.JSONException: java.lang.reflect.InvocationTargetException
   现在不正常了，换了mysql数据库也没用。

2010.06.05
----------

1、10:00 - 12:00

   搭建 ubuntu 开发环境

2、19:00 - 21:30

   http://loianegroner.com/tag/json-lib-ext-spring/

   22:00 - 2:30

   继续关注以上这个项目，争取改写成功


2010.06.04
----------

1、20:30 - 23:06

   extjs restful spring
   http://loianegroner.com/2010/05/populating-an-extjs-datagrid-rowexpander-using-spring-mvc-3/

2010.06.03
-----------

1、20:21 - 20:43
   21:02 - 21:32

   rest

2010.06.02
-----------

1、20:30 - 22:50

   rest

2010.05.25
-----------

1、21:30 - 22:32

   rest

2010.05.25
-----------

1、20:00 - 21:44

   增加c3po连接池，hibernate-ehcache

2010.05.24
-----------

1、19:00  -- 20:25
   21:00  -- 21:13
   21:17  -- 21:46
   22:10  -- 22：44

   --3.3.2中如何使用cache，方法与以前不同了，
   --Ehcache,showcase/cache，可用于页面缓存 StaticContentServlet，
   --以前采用hibernate 配置，只能用于数据库表缓存



   --END